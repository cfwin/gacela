<?php

/**
 * Generated by PHPUnit_SkeletonGenerator on 2012-10-21 at 14:11:44.
 */
class MapperTest extends \Test\TestCase {

	public function testSleep()
	{
		$mapper = \Gacela\Gacela::instance()->loadMapper('house');

		$str = serialize($mapper);

		$this->assertEquals($mapper, unserialize($str));
	}
	
	public function testSaveUpdateWhenOriginalDataEmpty()
	{
		$start = microtime(true);

		$former = array(
			'start' => date('c'),
			'method' => 'POST',
			'url' => '/unittest',
			'request' => ''
		);
		
		$data = array_merge(
			$former, 
			array(
				'end' => null,
				'response' => null,
				'status' => null,
				'elapsed' => null
			)
		);
			
		$mapper = \Gacela\Gacela::instance()->loadMapper('Log');

		$rs = $mapper->save(array_keys($former), $data, array());
		
		$this->assertInternalType('array',$rs);
		$this->assertSame(array_keys($data), array_keys($rs));

		$latter = array(
			'end' => date('c'),
			'response' => '',
			'status' => 200,
			'elapsed' => microtime(true)-$start
		);
			
		$changed = array_keys($latter);
		
		$data = array_merge($rs, $latter);
		
		$rs = $mapper->save(array_keys($latter), $data, array());

		$this->assertInternalType('array',$rs);
		$this->assertSame(array_keys($data), array_keys($rs));

	}
}
